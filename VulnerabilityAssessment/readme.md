The Vulnerability Assessment folder provides utilities that extend on OSSIM's inbuilt scanning. 

**Why would I want risk analysis for a vulnerability?**

By default it is not possible to use the awesome risk analysis metrics (Priority * Reliability * Asset Value / 25 = Risk) in to create alarms within Alienvault. The inbuilt ticket generation only is capable of using the OpenVAS rating (info, low, medium, high) to make a determination. 

For certain regulatory issues such as PCI-DSS - point 6.1.x in the 3.0 standard - threats need to be prioritized on the risk specific to a given environment. E.g. a higher CVSS threat raking on a lower priority server may actually be less important (4*4*1/25=.64) then a lower CVSS base score on a more important server (3*4*5/25=2.4). 

Response based strictly on the CVSS ranking would result in a more important system remaining at risk for a longer period of time. 

**Installing and activating the collector plugin**

Every time that a vulnerability scan is run in Alienvault the resulting events end up in /var/log/ossim/nessus_cron.log. This file can be automatically parsed via a collector plugin. 

To do so:
1. Install the included OpenVAS plugin (copy it to /etc/ossim/agent/plugins/openvas.cfg) 
2. Enable it (via the command line or GUI) 
3. This will result in SIEM events from the source "Nessus" being added at the conclusion of each scan. 
4. Each SIEM event will be assigned a risk based on the risk analysis metric. 

Note that if using this plugin you will want to disable the setting "Vulnerability Ticket Threshold" in the main Alienvault configuration screen. 


**SIEM events**

As you look through the created SIEM events you may see a number of 'nessus: Generic Events' displayed. 
When a OpenVAS result isn't yet categorized in the Alienvault database it is treated as a generic event. 
If you want to convert these generic events into alarms run the following commands. 

1. sudo ossim-db
2. update plugin_sid set reliability=7 where sid=2000000000 and plugin_id=3001;

**SIEM events and Alarms**

Any SIEM event with threat >= 1 is automatically converted into an alarm. 

**Notifications for Nessus Alarms**

Once a SIEM event is being generated Alienvault's standard threat intelligence is applicable. 

1. If necessary create a data source group Nessus. Use plugin ID 3001. 
2. Create an Action 'Nessus Alarms' that describes what actions to take in the event of a discovered event. 
2a. Use 'send email'. Use the Python boolean expression (RISK >=X) where X is your threshold for emailed alerts.  
3. Create a Threat Intelligence Policy. Use source and destination 'anywhere' and data source group Nessus. Action is 'Nessus Alarms'. 

**Relabelling Generic Events**

The generic events raised by Alienvault generally represent the most recently  added vulnerabilities. By my estimate it is about the last six months. In an environment which has already been secured these are among the most important checks that OpenVAS performs. 

For that reason I assembled a small Perl script, backfill_plugin_sid.pl. 
This script iterates the contents of the OpenVAS plugin library and cross references it to the SQL database - specifically the plugin_sid table - and fills in any missing references. 

Note that this is changing a database provided by Alienvault. As new releases from Alienvault come out you can expect the values added here may change if they are overwritten.

The process of labeling these events is tricky business. Although the priorities used map easily there isn't a good way to determine reliability. I have opted derive this value from the CVSS attack vector. It includes the severity of impact, points the attack can be run from and complexity of an attacker using an exploit. 

**Using the backfill_plugin_sid.pl script**

To use this script make it executable and drop it into the /etc/cron.daily folder. 